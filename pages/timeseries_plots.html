<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body> 
  <h1>Data visualisation for the Tiltaksovervakingen</h1>
  <p>These visualisations will take a few moments to load - please be patient.</p>  
  <p>The plots on this page highlight possible outliers (red dots) in the "new" data for individual time series (the vertical red line marks the boundary between the "historic" and "new" data series). The interquartile range (IQR) for the historic data is first calculated, then outliers in the "new" data are identified if values are either:</p>   
  <ul>
    <li>More than <b>3 * IQR above the upper quartile</b>, or
    <li>Less than <b>3 * IQR below the lower quartile</b>
  </ul>
  <p>Plots are shown for all data series with at least one identified outlier (where a "data series" is defined as a unique combination of station code, parameter and depth information). Note that plots are only shown for data series with <b>at least 50 measurements</b> in the historic period, to ensure the historic IQR can be estimated robustly.</p> 
  <p>The total number of data series with outliers is large. It is therefore recommended to use these plots to get an overall impression of the method and the output, but to refer to the CSV file <a href="https://github.com/NIVANorge/tiltaksovervakingen/blob/master/output/timerseries_outliers.csv">here</a> to see a full list of possible outliers</p>
  <p>Choose your station code, parameter and depth interval of interest from the drop-down list at the bottom of the screen to begin exploring the data.</p>
  <ul>
    <li>Use the <b>scroll wheel</b> on your mouse to <b>zoom in and out</b> on the plots</li>
    <li><b>Click-and-drag</b> to <b>pan</b> from side to side</li>
    <li><b>Double-click</b> to return to the <b>full extent</b> of the data (it is a good idea to do this when you change the parameter)</li>
    <li><b>Hover</b> the mouse pointer over data points to see additional details ("<b>tooltips</b>")</li>  
    <li>After selecting an option in the drop-down list, you may find it easier to use the <b>up and down arrow keys</b> (rather than the mouse) to change series</li>    
  </ul>

  <div id="vis"></div>
  
  <script>
    const spec = "timeseries_plots.json";
  	vegaEmbed("#vis", spec)
    	// result.view provides access to the Vega View API
      .then(result => console.log(result))
      .catch(console.warn);
  </script>
</body>